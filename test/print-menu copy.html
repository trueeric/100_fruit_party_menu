<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@latest/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ°´æœPARTYèœå–® - æ‰“å°ç‰ˆ</title>
    <style>
      @page {
        size: A4;
        margin: 12mm;
      }

      body {
        font-family: 'Noto Sans TC', Arial, sans-serif;
        background: #f8f4e8;
        margin: 0;
        padding: 0;
        color: #333;
        font-size: 13px;
        line-height: 1.4;
      }

      .menu-container {
        max-width: 210mm;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        padding: 18px;
        min-height: 297mm;
        box-sizing: border-box;
      }

      .header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 2px dashed #ffb6c1;
        padding-bottom: 12px;
      }

      h1 {
        color: #ff6b6b;
        font-size: 2.2em;
        margin: 0;
      }

      .table-number {
        font-size: 1.2em;
        color: #666;
        margin-top: 10px;
      }

      .menu-section {
        margin-bottom: 25px;
        page-break-inside: avoid;
      }

      .section-title {
        background: #ff6b6b;
        color: white;
        padding: 8px 15px;
        border-radius: 18px;
        display: inline-block;
        margin-bottom: 15px;
        font-size: 1.2em;
        font-weight: bold;
      }

      .traditional {
        background: #4ecdc4;
      }

      .fresh-fruit {
        background: #ff9f1c;
      }

      .new-items {
        background: #9c27b0;
      }

      /* æ¯å€‹ç³»åˆ—åˆ†ç‚ºå·¦å³å…©æ¬„ */
      .section-content {
        display: flex;
        gap: 18px;
      }

      .section-column {
        flex: 1;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px;
        background: #fafafa;
      }

      .column-header {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 10px;
        font-weight: bold;
        margin-bottom: 10px;
        padding: 0 10px;
        color: #495057;
        font-size: 1em;
        border-bottom: 1px solid #ddd;
        padding-bottom: 6px;
      }

      .column-header .price-header {
        text-align: right;
        min-width: 45px;
      }

      .column-header .quantity-header {
        text-align: center;
        width: 40px;
      }

      .menu-item {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 10px;
        align-items: center;
        padding: 8px 10px;
        border-radius: 6px;
        transition: all 0.2s;
        position: relative;
        margin-bottom: 4px;
      }

      .menu-item:hover {
        background: #f0f0f0;
      }

      .traditional-item {
        border-left: 3px solid #4ecdc4;
      }

      .fresh-fruit-item {
        border-left: 3px solid #ff9f1c;
      }

      .new-item {
        border-left: 3px solid #9c27b0;
      }

      .item-name {
        font-weight: 500;
        position: relative;
        font-size: 1em;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .item-price {
        color: #e63946;
        font-weight: bold;
        text-align: right;
        min-width: 45px;
        font-size: 1em;
      }

      .item-quantity {
        width: 40px;
        text-align: center;
        font-size: 0.9em;
      }

      .hot-tag {
        background: #e63946;
        color: white;
        font-size: 0.7em;
        padding: 2px 6px;
        border-radius: 10px;
        font-weight: bold;
        white-space: nowrap;
      }

      .notes {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 18px;
        border-left: 3px solid #6c757d;
        font-size: 0.95em;
      }

      .notes h3 {
        margin-top: 0;
        margin-bottom: 10px;
        color: #495057;
        font-size: 1.1em;
      }

      .add-on-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 12px;
      }

      .add-on-item {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9em;
      }

      .add-on-item input {
        margin: 0;
        transform: scale(1.2);
      }

      .notes textarea {
        width: 100%;
        height: 45px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 8px;
        margin-top: 6px;
        font-size: 0.9em;
        resize: vertical;
      }

      .notes p {
        margin: 5px 0;
        font-size: 0.9em;
      }

      .footer {
        text-align: center;
        margin-top: 25px;
        color: #6c757d;
        font-size: 0.85em;
      }

      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }

      @media print {
        body {
          background: white;
          font-size: 12px;
        }

        .menu-container {
          box-shadow: none;
          border-radius: 0;
          padding: 12px;
          margin: 0;
          max-width: 100%;
        }

        .menu-item:hover {
          background: transparent;
        }

        .no-print {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading">
      <div>è¼‰å…¥ä¸­...</div>
    </div>

    <div id="menu-content" style="display: none">
      <div class="menu-container">
        <div class="header">
          <h1 id="shop-name">ğŸ§ æ°´æœPARTYèœå–® ğŸ¦</h1>
          <div class="table-number">æ¡Œè™Ÿ: ____</div>
        </div>

        <div id="categories-container">
          <!-- é€™è£¡å°‡å‹•æ…‹å¡«å……åˆ†é¡å’Œèœå–®é …ç›® -->
        </div>

        <!-- åŠ è³¼é¸é … -->
        <div class="notes">
          <h3>åŠ é»é¸é …</h3>
          <div id="addons-container" class="add-on-container">
            <!-- é€™è£¡å°‡å‹•æ…‹å¡«å……åŠ è³¼é …ç›® -->
          </div>

          <h3>ç‰¹æ®Šéœ€æ±‚</h3>
          <p>â€¢ ç”œåº¦èª¿æ•´ï¼šæ­£å¸¸ / å°‘ç³– / åŠç³– / å¾®ç³– / ç„¡ç³–</p>
          <p>â€¢ å†°å¡Šï¼šæ­£å¸¸å†° / å°‘å†° / å»å†° / æº«ç†±</p>
          <textarea placeholder="å…¶ä»–å‚™è¨»äº‹é …..."></textarea>
        </div>

        <div class="footer">
          <p id="shop-hours">ç‡Ÿæ¥­æ™‚é–“ï¼š10:00-22:00 | é›»è©±ï¼š(02)1234-5678</p>
          <p id="shop-address">åœ°å€ï¼šå°åŒ—å¸‚ä¿¡ç¾©å€æ°´æœè¡—123è™Ÿ</p>
        </div>
      </div>

      <div class="no-print" style="text-align: center; margin: 20px">
        <button
          onclick="window.print()"
          style="
            padding: 10px 20px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
          "
        >
          æ‰“å°èœå–®
        </button>
      </div>
    </div>

    <script>
      // å¾ localStorage ç²å–æ•¸æ“š
      function fetchData() {
        try {
          // å˜—è©¦å¾ localStorage ç²å–æ•¸æ“š
          const storedData = localStorage.getItem('menuData')

          if (storedData) {
            const data = JSON.parse(storedData)
            renderMenu(data)
          } else {
            // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œé¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
            document.getElementById('loading').innerHTML =
              '<div>æ²’æœ‰æ‰¾åˆ°èœå–®æ•¸æ“šï¼Œè«‹å¾ Google Sheet ä¸­é¸æ“‡"æ‰“å°èœå–®"é¸é …</div>'
          }
        } catch (error) {
          console.error('ç²å–æ•¸æ“šå¤±æ•—:', error)
          document.getElementById('loading').innerHTML = '<div>è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦</div>'
        }
      }

      // æ¸²æŸ“èœå–®
      function renderMenu(data) {
        // éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
        document.getElementById('loading').style.display = 'none'
        // é¡¯ç¤ºèœå–®å…§å®¹
        document.getElementById('menu-content').style.display = 'block'

        // è¨­ç½®å•†åº—ä¿¡æ¯
        if (data.shopData) {
          document.getElementById('shop-name').textContent =
            `ğŸ§ ${data.shopData.shop_name || 'æ°´æœPARTYèœå–®'} ğŸ¦`

          // è¨­ç½®ç‡Ÿæ¥­æ™‚é–“å’Œé›»è©±
          let hoursText = 'ç‡Ÿæ¥­æ™‚é–“ï¼š'
          if (data.shopData.hours) {
            hoursText += data.shopData.hours
          } else {
            hoursText += '10:00-22:00'
          }

          hoursText += ' | é›»è©±ï¼š'
          if (data.shopData.phone) {
            hoursText += data.shopData.phone
          } else {
            hoursText += '(02)1234-5678'
          }

          document.getElementById('shop-hours').textContent = hoursText

          // è¨­ç½®åœ°å€
          document.getElementById('shop-address').textContent =
            `åœ°å€ï¼š${data.shopData.address || 'å°åŒ—å¸‚ä¿¡ç¾©å€æ°´æœè¡—123è™Ÿ'}`
        }

        // æ¸²æŸ“åˆ†é¡å’Œèœå–®é …ç›®
        const categoriesContainer = document.getElementById('categories-container')
        categoriesContainer.innerHTML = ''

        // å®šç¾©æ¨£å¼é¡å
        const categoryClasses = ['traditional', 'fresh-fruit', 'new-items']
        const itemClasses = ['traditional-item', 'fresh-fruit-item', 'new-item']

        if (data.categories && data.categories.length > 0) {
          data.categories.forEach((category, index) => {
            // ç²å–è©²åˆ†é¡ä¸‹çš„èœå–®é …ç›®
            const categoryItems = data.menuItems.filter((item) => item.category_id === category.id)

            if (categoryItems.length === 0) return

            // å°‡é …ç›®åˆ†ç‚ºå·¦å³å…©æ¬„
            const halfLength = Math.ceil(categoryItems.length / 2)
            const leftItems = categoryItems.slice(0, halfLength)
            const rightItems = categoryItems.slice(halfLength)

            // å‰µå»ºåˆ†é¡å€åŸŸ
            const sectionDiv = document.createElement('div')
            sectionDiv.className = 'menu-section'

            // åˆ†é¡æ¨™é¡Œ
            const titleDiv = document.createElement('div')
            titleDiv.className = `section-title ${categoryClasses[index % categoryClasses.length]}`
            titleDiv.textContent = category.c_name || category.name
            sectionDiv.appendChild(titleDiv)

            // åˆ†é¡å…§å®¹ï¼ˆå·¦å³å…©æ¬„ï¼‰
            const contentDiv = document.createElement('div')
            contentDiv.className = 'section-content'

            // å·¦æ¬„
            contentDiv.appendChild(
              createColumnWithItems(leftItems, itemClasses[index % itemClasses.length]),
            )

            // å³æ¬„
            contentDiv.appendChild(
              createColumnWithItems(rightItems, itemClasses[index % itemClasses.length]),
            )

            sectionDiv.appendChild(contentDiv)
            categoriesContainer.appendChild(sectionDiv)
          })
        }

        // æ¸²æŸ“åŠ è³¼é …ç›®
        const addonsContainer = document.getElementById('addons-container')
        addonsContainer.innerHTML = ''

        if (data.addOns && data.addOns.length > 0) {
          data.addOns.forEach((addon) => {
            const addonDiv = document.createElement('div')
            addonDiv.className = 'add-on-item'

            const checkbox = document.createElement('input')
            checkbox.type = 'checkbox'

            const label = document.createElement('label')
            label.innerHTML = `${addon.name} <span style="color: #e63946;">+$${addon.price}</span>`

            addonDiv.appendChild(checkbox)
            addonDiv.appendChild(label)

            addonsContainer.appendChild(addonDiv)
          })
        }

        // è‡ªå‹•æ‰“é–‹æ‰“å°å°è©±æ¡†
        setTimeout(() => {
          window.print()
        }, 1000)
      }

      // å‰µå»ºä¸€æ¬„èœå–®é …ç›®
      function createColumnWithItems(items, itemClass) {
        const column = document.createElement('div')
        column.className = 'section-column'

        // æ¬„æ¨™é¡Œ
        const header = document.createElement('div')
        header.className = 'column-header'
        header.innerHTML = `
          <div>å“é …</div>
          <div class="price-header">åƒ¹æ ¼</div>
          <div class="quantity-header">æ•¸é‡</div>
        `
        column.appendChild(header)

        // èœå–®é …ç›®
        items.forEach((item) => {
          const itemDiv = document.createElement('div')
          itemDiv.className = `menu-item ${itemClass}`

          // é …ç›®åç¨±
          const nameDiv = document.createElement('div')
          nameDiv.className = 'item-name'
          nameDiv.textContent = item.item_name

          // æª¢æŸ¥æ¨™ç±¤
          const tags = item.tags || ''

          // å¦‚æœæ¨™ç±¤ä¸­åŒ…å«"ç†±é–€"æˆ–"popular"
          if (tags.includes('ç†±é–€') || tags.includes('popular') || tags.includes('hot')) {
            const hotTag = document.createElement('span')
            hotTag.className = 'hot-tag'
            hotTag.textContent = 'ç†±é–€'
            nameDiv.appendChild(hotTag)
          }

          // å¦‚æœæ¨™ç±¤ä¸­åŒ…å«"æ–°å“"æˆ–"new"
          if (tags.includes('æ–°å“') || tags.includes('new')) {
            const newTag = document.createElement('span')
            newTag.className = 'hot-tag'
            newTag.textContent = 'æ–°å“'
            nameDiv.appendChild(newTag)
          }

          // åƒ¹æ ¼
          const priceDiv = document.createElement('div')
          priceDiv.className = 'item-price'
          priceDiv.textContent = `$${item.price}`

          // æ•¸é‡
          const quantityDiv = document.createElement('div')
          quantityDiv.className = 'item-quantity'
          quantityDiv.textContent = '____'

          itemDiv.appendChild(nameDiv)
          itemDiv.appendChild(priceDiv)
          itemDiv.appendChild(quantityDiv)

          column.appendChild(itemDiv)
        })

        return column
      }

      // é é¢è¼‰å…¥æ™‚ç²å–æ•¸æ“š
      document.addEventListener('DOMContentLoaded', fetchData)
    </script>
  </body>
</html>
